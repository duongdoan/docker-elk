input {
    file {
        path => "/root/mongodb.log"
        type => "mongodblog"
        start_position => "beginning"
    }
}

 
filter {
    if [type] == "mongodblog" {
        grok {
            match => ["message","%{TIMESTAMP_ISO8601:timestamp}\s+I %{WORD:MONGO_ACTION}\s+\[%{WORD:SOCK_ACTION}\]\s+%{GREEDYDATA:body}"]
            remove_field => [ "message" ]
        }

        if [body] =~ "ms$"  {  
            grok {
                match => ["body","%{WORD:command_action}\s+%{WORD:dbname}\.\$?%{WORD:collname}\s+%{GREEDYDATA:command_content}\s+%{NUMBER:time_spend}ms"]
            }
        }

        date {
            match => [ "timestamp", "UNIX", "YYYY-MM-dd HH:mm:ss", "ISO8601"]
            remove_field => [ "timestamp" ]
        }

        mutate {
            remove_field => ["message"]
        }
    }
}
 
output {
    elasticsearch {
        hosts => ["192.168.220.100:9200"]
        index => "mongodb-%{+YYYY.MM.dd}"
    }
}
